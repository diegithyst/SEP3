@page "/ViewAccount/{id:int}"
@using Domain.Model
@using HttpClients.ClientInterfaces
@inject IAccountService accountService

<div>
    <p>Id of the account: @id</p>
    <br/>
    <p>Name of the account: @name</p>
    <br/>
    <p>Currency of the account: @MainCurrency</p>
    <br/>
    <p>Loan of the account: @Loan</p>
    <br/>
    <p>Euros In Account: @_euro.balance </p>
    <br/>
    <p>Pounds In Account: @_pound.balance </p>
    <br/>
    <p>Krone In Account: @_krone.balance </p>
</div>

@code {
    [CascadingParameter]
    private Task<AuthenticationState> AuthState { get; set; } = null!;
    
    [Parameter]
    public int id { get; set; }
    private string MainCurrency = "";
    private bool Loan;
    private string name;
    private ICurrency _euro = new Euro();
    private ICurrency _pound= new Pound();
    private ICurrency _krone= new Krone();
    private string msg = "";

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var user = (await AuthState).User;
            id = Int32.Parse(user.Claims.First(claim => claim.Type.Equals("Id")).Value);
            
            Account account = await accountService.GetAccountAsync(id);
            MainCurrency = account.mainCurrency;
            Loan = account.loan;
            name = account.name;
            _euro = account.Euro;
            _pound = account.Pound;
            _krone = account.Krone;
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
            msg = e.Message;
        }
    }
}
